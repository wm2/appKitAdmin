import{defineStore as _}from"pinia";import{ref as m,computed as u}from"vue";import{a as l}from"../server-entry.js";import{Notify as i}from"quasar";import{u as b}from"./usePagination-CZ7Hsnrr.js";const V="2d7dd621-7a0c-4be8-ac04-46ec289dd34d",F=_("productTypes",()=>{const y=m([]),o=m(null),n=u(()=>V),r=b(async(e,t)=>{if(!n.value)throw new Error("VITE_SITE_ID не определен.");try{let a,s={};e?a=e:(a=`/sites/${n.value}/product-types/`,s=Object.entries(t||{}).reduce((g,[d,v])=>(v!==void 0&&(g[d]=v),g),{}));const{data:f}=await l.get(a,{params:e?{}:s});return y.value=f.results,f}catch(a){throw c(a,"Не удалось загрузить список типов товаров."),a}},{defaultPageSize:10,defaultSortBy:"name",defaultDescending:!1});function c(e,t){console.error(t,e);let a=t;const s=e.response?.data;if(typeof s=="string"?a=s:s?.detail?a=s.detail:s?.message?a=s.message:e.message&&(a=e.message),s&&typeof s=="object"&&!s.detail&&!s.message){const f=Object.entries(s).map(([g,d])=>`${g}: ${Array.isArray(d)?d.join(", "):String(d)}`).join("; ");f&&(a=f)}i.create({type:"negative",message:a,timeout:5e3})}async function p(e){return r.fetchData(e)}async function T(e){if(!n.value)return i.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await l.get(`/sites/${n.value}/product-types/${e}/`);return o.value=t,t}catch(t){return c(t,"Не удалось загрузить данные типа товара."),o.value=null,null}}async function P(e){if(!n.value)return i.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await l.post(`/sites/${n.value}/product-types/`,e);return i.create({type:"positive",message:`Тип товара "${t.name}" успешно создан.`}),await p(),t}catch(t){return c(t,"Ошибка при создании типа товара."),null}}async function h(e,t){if(!n.value)return i.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:a}=await l.put(`/sites/${n.value}/product-types/${e}/`,t);return i.create({type:"positive",message:`Тип товара "${a.name}" успешно обновлен.`}),await p(),o.value?.id===e&&await T(e),a}catch(a){return c(a,"Ошибка при обновлении типа товара."),null}}async function I(e){if(!n.value)return i.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await l.delete(`/sites/${n.value}/product-types/${e}/`),i.create({type:"positive",message:"Тип товара успешно удален."}),await p(),o.value?.id===e&&(o.value=null),!0}catch(t){return c(t,"Ошибка при удалении типа товара."),!1}}function E(){o.value=null}async function w(e){if(!n.value)return i.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await Promise.all(e.map(t=>l.delete(`/sites/${n.value}/product-types/${t}/`))),i.create({type:"positive",message:`Успешно удалено ${e.length} типов товаров.`}),await p(),!0}catch(t){return c(t,"Ошибка при массовом удалении типов товаров."),!1}}async function S(e){return r.setSearch(e),await r.fetchData()}async function $(e){return Object.entries(e).forEach(([t,a])=>{r.setFilter(t,a)}),await r.fetchData()}async function D(){return r.clearFilters(),await r.fetchData()}return{productTypes:y,selectedProductType:o,loading:r.loading,currentPage:u(()=>r.currentPage.value),pageSize:u(()=>r.pageSize.value),totalCount:u(()=>r.totalCount.value),totalPages:u(()=>r.totalPages.value),hasNext:u(()=>r.hasNext.value),hasPrevious:u(()=>r.hasPrevious.value),qTablePagination:r.qTablePagination,fetchProductTypes:p,fetchProductTypeById:T,createProductType:P,updateProductType:h,deleteProductType:I,clearSelectedProductType:E,searchProductTypes:S,filterProductTypes:$,clearFilters:D,bulkDeleteProductTypes:w,goToPage:r.goToPage,goToNextPage:r.goToNextPage,goToPreviousPage:r.goToPreviousPage,handleTableRequest:r.handleTableRequest}});export{F as u};
