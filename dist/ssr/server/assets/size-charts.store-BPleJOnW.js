import{defineStore as $}from"pinia";import{ref as y,computed as l}from"vue";import{a as c}from"../server-entry.js";import{Notify as n}from"quasar";import{u as D}from"./usePagination-CZ7Hsnrr.js";const _="2d7dd621-7a0c-4be8-ac04-46ec289dd34d",A=$("sizeCharts",()=>{const m=y([]),o=y(null),i=l(()=>_),r=D(async(e,t)=>{if(!i.value)throw new Error("VITE_SITE_ID не определен.");try{let a,s={};e?a=e:(a=`/sites/${i.value}/size-charts/`,s=Object.entries(t||{}).reduce((v,[h,d])=>(d!==void 0&&(v[h]=d),v),{}));const{data:g}=await c.get(a,{params:e?{}:s});return m.value=g.results,g}catch(a){throw u(a,"Не удалось загрузить список размерных сеток."),a}},{defaultPageSize:10,defaultSortBy:"name",defaultDescending:!1});function u(e,t){console.error(t,e);let a=t;const s=e.response?.data;if(typeof s=="string"?a=s:s?.detail?a=s.detail:s?.message?a=s.message:e.message&&(a=e.message),s&&typeof s=="object"&&!s.detail&&!s.message){const g=Object.entries(s).map(([v,h])=>`${v}: ${Array.isArray(h)?h.join(", "):String(h)}`).join("; ");g&&(a=g)}n.create({type:"negative",message:a,timeout:5e3})}async function f(e){return r.fetchData(e)}async function p(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await c.get(`/sites/${i.value}/size-charts/${e}/`);return o.value=t,t}catch(t){return u(t,"Не удалось загрузить данные размерной сетки."),o.value=null,null}}async function S(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await c.post(`/sites/${i.value}/size-charts/`,e);return n.create({type:"positive",message:`Размерная сетка "${t.name}" успешно создана.`}),await f(),t}catch(t){return u(t,"Ошибка при создании размерной сетки."),null}}async function z(e,t){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:a}=await c.put(`/sites/${i.value}/size-charts/${e}/`,t);return n.create({type:"positive",message:`Размерная сетка "${a.name}" успешно обновлена.`}),await f(),o.value?.id===e&&await p(e),a}catch(a){return u(a,"Ошибка при обновлении размерной сетки."),null}}async function T(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await c.delete(`/sites/${i.value}/size-charts/${e}/`),n.create({type:"positive",message:"Размерная сетка успешно удалена."}),await f(),o.value?.id===e&&(o.value=null),!0}catch(t){return u(t,"Ошибка при удалении размерной сетки."),!1}}function P(){o.value=null}async function I(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await Promise.all(e.map(t=>c.delete(`/sites/${i.value}/size-charts/${t}/`))),n.create({type:"positive",message:`Успешно удалено ${e.length} размерных сеток.`}),await f(),!0}catch(t){return u(t,"Ошибка при массовом удалении размерных сеток."),!1}}async function E(e){return r.setSearch(e),await r.fetchData()}async function w(e){return Object.entries(e).forEach(([t,a])=>{r.setFilter(t,a)}),await r.fetchData()}async function C(){return r.clearFilters(),await r.fetchData()}return{sizeCharts:m,selectedSizeChart:o,loading:r.loading,currentPage:l(()=>r.currentPage.value),pageSize:l(()=>r.pageSize.value),totalCount:l(()=>r.totalCount.value),totalPages:l(()=>r.totalPages.value),hasNext:l(()=>r.hasNext.value),hasPrevious:l(()=>r.hasPrevious.value),qTablePagination:r.qTablePagination,fetchSizeCharts:f,fetchSizeChartById:p,createSizeChart:S,updateSizeChart:z,deleteSizeChart:T,clearSelectedSizeChart:P,searchSizeCharts:E,filterSizeCharts:w,clearFilters:C,bulkDeleteSizeCharts:I,goToPage:r.goToPage,goToNextPage:r.goToNextPage,goToPreviousPage:r.goToPreviousPage,handleTableRequest:r.handleTableRequest}});export{A as u};
