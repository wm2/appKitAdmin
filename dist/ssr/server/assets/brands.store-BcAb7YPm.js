import{defineStore as B}from"pinia";import{ref as T,computed as d}from"vue";import{a as c}from"../server-entry.js";import{Notify as s}from"quasar";import{u as x}from"./usePagination-CZ7Hsnrr.js";const V="2d7dd621-7a0c-4be8-ac04-46ec289dd34d",A=B("brands",()=>{const u=T([]),o=T(null),i=d(()=>V),n=x(async(e,t)=>{if(!i.value)throw new Error("VITE_SITE_ID не определен.");try{let a,r={};e?a=e:(a=`/sites/${i.value}/brands/`,r=Object.entries(t||{}).reduce((m,[g,h])=>(h!==void 0&&(m[g]=h),m),{}));const{data:f}=await c.get(a,{params:e?{}:r});return u.value=f.results,f}catch(a){throw l(a,"Не удалось загрузить список брендов."),a}},{defaultPageSize:10,defaultSortBy:"name",defaultDescending:!1});function l(e,t){console.error(t,e);let a=t;const r=e.response?.data;if(typeof r=="string"?a=r:r?.detail?a=r.detail:r?.message?a=r.message:e.message&&(a=e.message),r&&typeof r=="object"&&!r.detail&&!r.message){const f=Object.entries(r).map(([m,g])=>`${m}: ${Array.isArray(g)?g.join(", "):String(g)}`).join("; ");f&&(a=f)}s.create({type:"negative",message:a,timeout:5e3})}async function p(e){return n.fetchData(e)}async function v(e){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await c.get(`/sites/${i.value}/brands/${e}/`);return o.value=t,t}catch(t){return l(t,"Не удалось загрузить данные бренда."),o.value=null,null}}async function y(e){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const t=new FormData;t.append("name",e.name),e.description&&t.append("description",e.description),e.is_published!==void 0&&t.append("is_published",String(e.is_published)),e.file&&t.append("file",e.file);const{data:a}=await c.post(`/sites/${i.value}/brands/`,t,{headers:{"Content-Type":"multipart/form-data"}});return s.create({type:"positive",message:`Бренд "${a.name}" успешно создан.`}),await p(),a}catch(t){return l(t,"Ошибка при создании бренда."),null}}async function I(e,t){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const a=new FormData;t.name&&a.append("name",t.name),t.description&&a.append("description",t.description),t.is_published!==void 0&&a.append("is_published",String(t.is_published)),t.file&&a.append("file",t.file);const{data:r}=await c.put(`/sites/${i.value}/brands/${e}/`,a,{headers:{"Content-Type":"multipart/form-data"}});return s.create({type:"positive",message:`Бренд "${r.name}" успешно обновлен.`}),await p(),o.value?.id===e&&await v(e),r}catch(a){return l(a,"Ошибка при обновлении бренда."),null}}async function _(e){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await c.delete(`/sites/${i.value}/brands/${e}/`),s.create({type:"positive",message:"Бренд успешно удален."}),await p(),o.value?.id===e&&(o.value=null),!0}catch(t){return l(t,"Ошибка при удалении бренда."),!1}}function E(){o.value=null}async function P(e,t){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{await c.patch(`/sites/${i.value}/brands/${e}/`,{is_published:t});const a=u.value.findIndex(r=>r.id===e);return a!==-1&&u.value[a]&&(u.value[a].is_published=t),!0}catch(a){return l(a,"Ошибка при изменении статуса публикации."),!1}}async function b(e){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await Promise.all(e.map(t=>c.delete(`/sites/${i.value}/brands/${t}/`))),s.create({type:"positive",message:`Успешно удалено ${e.length} брендов.`}),await p(),!0}catch(t){return l(t,"Ошибка при массовом удалении брендов."),!1}}async function S(e,t){if(!i.value)return s.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await Promise.all(e.map(a=>c.patch(`/sites/${i.value}/brands/${a}/`,{is_published:t}))),e.forEach(a=>{const r=u.value.findIndex(f=>f.id===a);r!==-1&&u.value[r]&&(u.value[r].is_published=t)}),s.create({type:"positive",message:`Успешно обновлено ${e.length} брендов.`}),!0}catch(a){return l(a,"Ошибка при массовом обновлении статуса публикации."),!1}}async function w(e){return n.setSearch(e),await n.fetchData()}async function D(e){return Object.entries(e).forEach(([t,a])=>{n.setFilter(t,a)}),await n.fetchData()}async function $(){return n.clearFilters(),await n.fetchData()}return{brands:u,selectedBrand:o,loading:n.loading,currentPage:d(()=>n.currentPage.value),pageSize:d(()=>n.pageSize.value),totalCount:d(()=>n.totalCount.value),totalPages:d(()=>n.totalPages.value),hasNext:d(()=>n.hasNext.value),hasPrevious:d(()=>n.hasPrevious.value),qTablePagination:n.qTablePagination,fetchBrands:p,fetchBrandById:v,createBrand:y,updateBrand:I,deleteBrand:_,clearSelectedBrand:E,searchBrands:w,filterBrands:D,clearFilters:$,patchBrandStatus:P,bulkDeleteBrands:b,bulkUpdateBrandStatus:S,goToPage:n.goToPage,goToNextPage:n.goToNextPage,goToPreviousPage:n.goToPreviousPage,handleTableRequest:n.handleTableRequest}});export{A as u};
