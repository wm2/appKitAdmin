import{d as me,r as b,a2 as pe,v as w,o as f,x as l,a as i,c as h,y as g,e,f as v,z as o,ao as V,ap as q,aq as fe,B as r,ar as N,a5 as k,am as ve,as as P,A as d,a9 as _e,aa as ye,au as ge,at as Y,av as A,aw as H,aC as be,aD as xe,ay as G,D as J,az as K}from"./index-CXeQdQLH.js";import{u as we,a as Ce,b as he,c as R,Q as E,d as ke,g as ze,C as W,e as qe,f as Se}from"./date-CyQUtB3O.js";import{Q as L,d as C,e as x,f as _,a as De}from"./usePagination-CH_YJQGk.js";import{Q as Qe}from"./QPage-7ngJVt63.js";import{u as Ve}from"./size-charts.store-B0ebQcwc.js";import{u as Pe}from"./product-types.store-CSsMRRDK.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Be={class:"q-mb-md"},Ie={class:"row justify-between items-center"},Ue={key:0,class:"q-mt-sm"},$e={class:"text-blue-8 text-body2"},Fe={class:"row q-gutter-xs"},Ne={class:"q-mb-md"},Re={key:0,class:"flex flex-center q-pa-md"},Ee={key:1,class:"desktop-view"},Le={class:"text-truncate",style:{"max-width":"200px"}},je={class:"row no-wrap q-gutter-xs justify-end"},Me={class:"full-width row flex-center text-accent q-gutter-sm"},Oe={key:2,class:"mobile-view"},Ye={class:"row items-center justify-between q-mb-md"},Ae={class:"text-caption text-grey-7"},He={class:"row q-gutter-xs"},Ge={class:"text-caption q-px-sm"},Je={class:"q-gutter-sm"},Ke={class:"row items-center full-width no-wrap"},We={class:"col-grow q-mr-md"},Xe={class:"text-weight-medium"},Ze={class:"text-caption text-grey-6"},et={key:0,class:"text-body2 q-mb-md"},tt={class:"text-body2 q-mb-md"},lt={class:"column q-gutter-sm"},at={class:"row q-gutter-sm"},st={key:0,class:"text-center q-pa-lg"},ot={class:"text-h6"},it=me({__name:"SizeChartsPage",setup(nt){const u=we(),n=Ve(),T=Pe(),S=b(!1),z=b(!1),D=b(!1),c=b(null),B=b(""),y=b([]),I=b(!1),j=b([]),U=b(!1),m=b({name:"",description:"",product_type:""}),X=[{name:"name",required:!0,label:"Название",align:"left",field:"name",sortable:!0},{name:"description",label:"Описание",field:"description",align:"left",sortable:!1},{name:"product_type",label:"Тип товара",field:"product_type",align:"left",sortable:!1},{name:"actions",label:"Действия",field:"id",align:"right"}];async function Q(s=""){U.value=!0;try{s?await T.filterProductTypes({name:s}):await T.fetchProductTypes(),j.value=T.productTypes}catch(t){console.error("Error loading product types:",t)}finally{U.value=!1}}function Z(s,t){t(()=>{s===""?Q():Q(s)})}function ee(s,t){t?y.value.some(a=>a.id===s.id)||y.value.push(s):y.value=y.value.filter(a=>a.id!==s.id)}async function te(s){s.pagination&&await n.handleTableRequest(s)}async function le(s){const t=s?String(s).trim():"";t.length>=2?await n.filterSizeCharts({name:t}):t.length===0&&await n.clearFilters()}async function ae(){B.value="",await n.clearFilters()}async function M(s){const t=await n.fetchSizeChartById(s.id);t&&(c.value=t,z.value=!0)}async function se(){D.value=!1,m.value={name:"",description:"",product_type:""},await Q(),S.value=!0}async function $(s){D.value=!0;const t=await n.fetchSizeChartById(s.id);t?m.value={id:t.id,name:t.name,description:t.description||"",product_type:t.product_type.id}:m.value={id:s.id,name:s.name,description:s.description||"",product_type:s.product_type.id},await Q(),S.value=!0}async function oe(){if(!m.value.name){u.notify({type:"negative",message:"Название размерной сетки обязательно."});return}if(!m.value.product_type){u.notify({type:"negative",message:"Тип товара обязателен."});return}const s={name:m.value.name,description:m.value.description||"",product_type:m.value.product_type};let t=!1;D.value&&m.value.id?await n.updateSizeChart(m.value.id,s)&&(t=!0):await n.createSizeChart(s)&&(t=!0),t&&(S.value=!1)}function ie(){K.create({title:"Подтвердите удаление",message:`Вы уверены, что хотите удалить ${y.value.length} элементов?`,persistent:!0,ok:{label:"Удалить",color:"negative"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{ne()})}async function ne(){I.value=!0;try{await n.bulkDeleteSizeCharts(y.value.map(t=>t.id))&&(y.value=[])}finally{I.value=!1}}function F(s){K.create({title:"Подтвердите удаление",message:`Вы уверены, что хотите удалить размерную сетку "${s.name}"?`,persistent:!0,ok:{label:"Удалить",color:"negative"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{n.deleteSizeChart(s.id).catch(t=>{u.notify({type:"negative",message:"Ошибка при удалении размерной сетки"}),console.error("Delete size chart error:",t)})})}async function de(s,t){const a=s.target;if(a.closest(".q-btn")||a.closest("button"))return;const p=await n.fetchSizeChartById(t.id);p&&(c.value=p,z.value=!0)}async function re(){c.value&&(z.value=!1,await $(c.value))}function ue(){c.value&&(z.value=!1,F(c.value))}function O(s){return Se.formatDate(s,"DD.MM.YYYY HH:mm")}return pe(async()=>{await n.fetchSizeCharts()}),(s,t)=>(f(),w(Qe,{padding:""},{default:l(()=>[i("div",Be,[i("div",Ie,[t[9]||(t[9]=i("div",{class:"text-h5"},"Управление размерными сетками",-1)),e(v,{color:"primary",icon:"add",onClick:se,label:o(u).screen.gt.xs?"Добавить сетку":"",round:o(u).screen.xs},null,8,["label","round"])]),e(Ce,null,{default:l(()=>[y.value.length>0?(f(),h("div",Ue,[e(V,{flat:"",bordered:"",class:"bg-blue-1"},{default:l(()=>[e(q,{class:"q-pa-sm"},{default:l(()=>[i("div",{class:fe(o(u).screen.xs?"column q-gutter-y-sm":"row items-center justify-between")},[i("span",$e,r(y.value.length)+" выбрано",1),i("div",Fe,[e(v,{dense:o(u).screen.xs,size:(o(u).screen.xs,"md"),flat:"",color:"negative",icon:"delete",onClick:ie,loading:I.value,label:"Удалить"},null,8,["dense","size","loading"])])],2)]),_:1})]),_:1})])):g("",!0)]),_:1})]),i("div",Ne,[e(N,{modelValue:B.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>B.value=a),le],placeholder:"Поиск по названию размерной сетки...",clearable:"",outlined:"",dense:"",onClear:ae},{prepend:l(()=>[e(k,{name:"search"})]),_:1},8,["modelValue"])]),o(n).loading?(f(),h("div",Re,[e(ve,{color:"primary",size:"3em"})])):g("",!0),!o(n).loading&&o(u).screen.gt.xs?(f(),h("div",Ee,[e(he,{title:"Размерные сетки",rows:o(n).sizeCharts,columns:X,"row-key":"id",loading:o(n).loading,pagination:o(n).qTablePagination,"onUpdate:pagination":t[1]||(t[1]=a=>o(n).qTablePagination=a),selected:y.value,"onUpdate:selected":t[2]||(t[2]=a=>y.value=a),selection:"multiple",onRequest:te,onRowClick:de,"binary-state-sort":"","rows-per-page-options":[5,10,20,30,50],class:"cursor-pointer size-charts-table"},{"body-cell-description":l(a=>[e(R,{props:a},{default:l(()=>[i("div",Le,r(a.row.description||"-"),1)]),_:2},1032,["props"])]),"body-cell-product_type":l(a=>[e(R,{props:a},{default:l(()=>[e(E,{color:"primary","text-color":"white",size:"sm",icon:"category"},{default:l(()=>[d(r(a.row.product_type.name),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[e(R,{props:a,class:"text-right"},{default:l(()=>[i("div",je,[e(v,{flat:"",round:"",dense:"",icon:"visibility",color:"primary",onClick:P(p=>M(a.row),["stop"])},{default:l(()=>[e(L,null,{default:l(()=>t[10]||(t[10]=[d("Просмотр")])),_:1,__:[10]})]),_:2},1032,["onClick"]),e(v,{flat:"",round:"",dense:"",icon:"edit",onClick:P(p=>$(a.row),["stop"])},{default:l(()=>[e(L,null,{default:l(()=>t[11]||(t[11]=[d("Редактировать")])),_:1,__:[11]})]),_:2},1032,["onClick"]),e(v,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:P(p=>F(a.row),["stop"])},{default:l(()=>[e(L,null,{default:l(()=>t[12]||(t[12]=[d("Удалить")])),_:1,__:[12]})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":l(({icon:a,message:p,filter:ce})=>[i("div",Me,[e(k,{size:"2em",name:ce?"filter_b_and_w":a},null,8,["name"]),i("span",null,r(p),1)])]),_:1},8,["rows","loading","pagination","selected"])])):g("",!0),!o(n).loading&&o(u).screen.xs?(f(),h("div",Oe,[i("div",Ye,[i("div",Ae,"Всего: "+r(o(n).totalCount),1),i("div",He,[e(v,{flat:"",dense:"",icon:"chevron_left",onClick:o(n).goToPreviousPage,disable:!o(n).hasPrevious},null,8,["onClick","disable"]),i("span",Ge,r(o(n).currentPage)+" / "+r(o(n).totalPages),1),e(v,{flat:"",dense:"",icon:"chevron_right",onClick:o(n).goToNextPage,disable:!o(n).hasNext},null,8,["onClick","disable"])])]),i("div",Je,[(f(!0),h(_e,null,ye(o(n).sizeCharts,a=>(f(),w(ke,{key:a.id,class:"size-chart-card","header-class":y.value.some(p=>p.id===a.id)?"bg-blue-1":""},{header:l(()=>[i("div",Ke,[e(ge,{"model-value":y.value.some(p=>p.id===a.id),"onUpdate:modelValue":p=>ee(a,p),class:"q-mr-sm",onClick:t[3]||(t[3]=P(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),e(Y,{size:"40px",class:"q-mr-md bg-primary text-white"},{default:l(()=>[e(k,{name:"grid_on"})]),_:1}),i("div",We,[i("div",Xe,r(a.name),1),i("div",Ze,r(a.product_type.name),1)])])]),default:l(()=>[e(V,{flat:""},{default:l(()=>[e(q,{class:"q-pt-none"},{default:l(()=>[a.description?(f(),h("div",et,[t[13]||(t[13]=i("strong",null,"Описание:",-1)),t[14]||(t[14]=i("br",null,null,-1)),d(" "+r(a.description),1)])):g("",!0),i("div",tt,[t[15]||(t[15]=i("strong",null,"Тип товара:",-1)),t[16]||(t[16]=i("br",null,null,-1)),e(E,{color:"primary","text-color":"white",size:"sm",icon:"category"},{default:l(()=>[d(r(a.product_type.name),1)]),_:2},1024)]),i("div",lt,[e(v,{unelevated:"",color:"primary",icon:"visibility",label:"Просмотреть детали",onClick:p=>M(a),class:"full-width"},null,8,["onClick"]),i("div",at,[e(v,{outline:"",color:"warning",icon:"edit",label:"Изменить",onClick:p=>$(a),class:"col"},null,8,["onClick"]),e(v,{outline:"",color:"negative",icon:"delete",label:"Удалить",onClick:p=>F(a),class:"col"},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["header-class"]))),128))]),o(n).sizeCharts.length===0?(f(),h("div",st,[e(k,{name:"grid_on",size:"4em",color:"grey-4"}),t[17]||(t[17]=i("div",{class:"text-grey-6 q-mt-sm"},"Размерные сетки не найдены",-1))])):g("",!0)])):g("",!0),e(A,{modelValue:S.value,"onUpdate:modelValue":t[7]||(t[7]=a=>S.value=a),persistent:"",maximized:o(u).screen.xs},{default:l(()=>[e(V,{style:H(o(u).screen.xs?"":"min-width: 500px")},{default:l(()=>[e(q,null,{default:l(()=>[i("div",ot,r(D.value?"Редактировать размерную сетку":"Добавить размерную сетку"),1)]),_:1}),e(q,{class:"q-pt-none"},{default:l(()=>[e(N,{modelValue:m.value.name,"onUpdate:modelValue":t[4]||(t[4]=a=>m.value.name=a),label:"Название *",autofocus:"",rules:[a=>!!a||"Название обязательно"],"lazy-rules":"",class:"q-mb-md"},null,8,["modelValue","rules"]),e(ze,{modelValue:m.value.product_type,"onUpdate:modelValue":t[5]||(t[5]=a=>m.value.product_type=a),options:j.value,"option-label":"name","option-value":"id",label:"Тип товара *","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"","input-debounce":"300",loading:U.value,onFilter:Z,rules:[a=>!!a||"Тип товара обязателен"],"lazy-rules":"",class:"q-mb-md"},{prepend:l(()=>[e(k,{name:"category"})]),"no-option":l(()=>[e(C,null,{default:l(()=>[e(x,{class:"text-grey"},{default:l(()=>t[18]||(t[18]=[d(" Типы товаров не найдены ")])),_:1,__:[18]})]),_:1})]),option:l(a=>[e(C,be(xe(a.itemProps)),{default:l(()=>[e(x,{avatar:""},{default:l(()=>[e(k,{name:"category",color:"primary"})]),_:1}),e(x,null,{default:l(()=>[e(_,null,{default:l(()=>[d(r(a.opt.name),1)]),_:2},1024),a.opt.description?(f(),w(_,{key:0,caption:""},{default:l(()=>[d(r(a.opt.description),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading","rules"]),e(N,{modelValue:m.value.description,"onUpdate:modelValue":t[6]||(t[6]=a=>m.value.description=a),label:"Описание",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),e(G,{align:"right"},{default:l(()=>[J(e(v,{flat:"",label:"Отмена"},null,512),[[W]]),e(v,{flat:"",label:"Сохранить",color:"primary",onClick:oe,loading:o(n).loading},null,8,["loading"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"]),e(A,{modelValue:z.value,"onUpdate:modelValue":t[8]||(t[8]=a=>z.value=a),maximized:o(u).screen.xs},{default:l(()=>[e(V,{style:H(o(u).screen.xs?"":"min-width: 500px; max-width: 600px")},{default:l(()=>[e(q,{class:"row items-center q-pb-none"},{default:l(()=>[t[19]||(t[19]=i("div",{class:"text-h6"},"Детали размерной сетки",-1)),e(qe),J(e(v,{icon:"close",flat:"",round:"",dense:""},null,512),[[W]])]),_:1,__:[19]}),c.value?(f(),w(q,{key:0},{default:l(()=>[e(De,null,{default:l(()=>[e(C,null,{default:l(()=>[e(x,{avatar:""},{default:l(()=>[e(Y,{color:"primary","text-color":"white"},{default:l(()=>[e(k,{name:"grid_on"})]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(_,{class:"text-weight-medium"},{default:l(()=>t[20]||(t[20]=[d("Название")])),_:1,__:[20]}),e(_,{caption:"",class:"text-body1"},{default:l(()=>[d(r(c.value.name),1)]),_:1})]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(x,null,{default:l(()=>[e(_,{class:"text-weight-medium"},{default:l(()=>t[21]||(t[21]=[d("Тип товара")])),_:1,__:[21]}),e(_,{caption:""},{default:l(()=>[e(E,{color:"primary","text-color":"white",size:"sm",icon:"category"},{default:l(()=>[d(r(c.value.product_type.name),1)]),_:1})]),_:1})]),_:1})]),_:1}),c.value.description?(f(),w(C,{key:0},{default:l(()=>[e(x,null,{default:l(()=>[e(_,{class:"text-weight-medium"},{default:l(()=>t[22]||(t[22]=[d("Описание")])),_:1,__:[22]}),e(_,{caption:"",class:"text-body1"},{default:l(()=>[d(r(c.value.description),1)]),_:1})]),_:1})]),_:1})):g("",!0),c.value.creator?(f(),w(C,{key:1},{default:l(()=>[e(x,null,{default:l(()=>[e(_,{class:"text-weight-medium"},{default:l(()=>t[23]||(t[23]=[d("Создатель")])),_:1,__:[23]}),e(_,{caption:"",class:"text-body1"},{default:l(()=>[d(r(c.value.creator.email),1)]),_:1})]),_:1})]),_:1})):g("",!0),c.value.created?(f(),w(C,{key:2},{default:l(()=>[e(x,null,{default:l(()=>[e(_,{class:"text-weight-medium"},{default:l(()=>t[24]||(t[24]=[d("Дата создания")])),_:1,__:[24]}),e(_,{caption:"",class:"text-body1"},{default:l(()=>[d(r(O(c.value.created)),1)]),_:1})]),_:1})]),_:1})):g("",!0),c.value.updated?(f(),w(C,{key:3},{default:l(()=>[e(x,null,{default:l(()=>[e(_,{class:"text-weight-medium"},{default:l(()=>t[25]||(t[25]=[d("Дата обновления")])),_:1,__:[25]}),e(_,{caption:"",class:"text-body1"},{default:l(()=>[d(r(O(c.value.updated)),1)]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1})):g("",!0),e(G,{align:"right",class:"q-pa-md"},{default:l(()=>[e(v,{label:o(u).screen.xs?"":"Редактировать",color:"primary",onClick:re,icon:"edit",round:o(u).screen.xs},null,8,["label","round"]),e(v,{label:o(u).screen.xs?"":"Удалить",color:"negative",onClick:ue,icon:"delete",round:o(u).screen.xs},null,8,["label","round"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])]),_:1}))}}),vt=Te(it,[["__scopeId","data-v-e7c81617"]]);export{vt as default};
