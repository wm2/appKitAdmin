import{d as ne,r as b,a2 as ie,v as x,o as f,x as l,a as i,c as w,y,e as t,f as c,z as s,ao as Q,ap as T,aq as de,B as m,ar as U,a5 as q,am as ue,as as V,A as p,a9 as re,aa as ce,au as me,at as R,av as j,aw as E,ay as L,D as M,az as Y}from"./index-CXeQdQLH.js";import{u as fe,a as pe,b as ve,c as A,d as ge,C as O,e as ye,f as _e}from"./date-CyQUtB3O.js";import{Q as $,a as be,d as P,e as h,f as _}from"./usePagination-CH_YJQGk.js";import{Q as xe}from"./QPage-7ngJVt63.js";import{u as we}from"./product-types.store-CSsMRRDK.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"q-mb-md"},he={class:"row justify-between items-center"},Ce={key:0,class:"q-mt-sm"},qe={class:"text-blue-8 text-body2"},Pe={class:"row q-gutter-xs"},De={class:"q-mb-md"},Qe={key:0,class:"flex flex-center q-pa-md"},Ve={key:1,class:"desktop-view"},ze={class:"text-truncate",style:{"max-width":"200px"}},Se={class:"row no-wrap q-gutter-xs justify-end"},Be={class:"full-width row flex-center text-accent q-gutter-sm"},Ie={key:2,class:"mobile-view"},Ue={class:"row items-center justify-between q-mb-md"},$e={class:"text-caption text-grey-7"},Fe={class:"row q-gutter-xs"},Ne={class:"text-caption q-px-sm"},Re={class:"q-gutter-sm"},je={class:"row items-center full-width no-wrap"},Ee={class:"col-grow q-mr-md"},Le={class:"text-weight-medium"},Me={class:"text-caption text-grey-6"},Ye={key:0,class:"text-body2 q-mb-md"},Ae={class:"column q-gutter-sm"},Oe={class:"row q-gutter-sm"},He={key:0,class:"text-center q-pa-lg"},Ge={class:"text-h6"},Je=ne({__name:"ProductTypesPage",setup(Ke){const d=fe(),o=we(),C=b(!1),k=b(!1),D=b(!1),u=b(null),z=b(""),v=b([]),S=b(!1),g=b({name:"",description:""}),H=[{name:"name",required:!0,label:"Название",align:"left",field:"name",sortable:!0},{name:"description",label:"Описание",field:"description",align:"left",sortable:!1},{name:"actions",label:"Действия",field:"id",align:"right"}];function G(n,e){e?v.value.some(a=>a.id===n.id)||v.value.push(n):v.value=v.value.filter(a=>a.id!==n.id)}async function J(n){n.pagination&&await o.handleTableRequest(n)}async function K(n){const e=n?String(n).trim():"";e.length>=2?await o.filterProductTypes({name:e}):e.length===0&&await o.clearFilters()}async function W(){z.value="",await o.clearFilters()}async function F(n){const e=await o.fetchProductTypeById(n.id);e&&(u.value=e,k.value=!0)}function X(){D.value=!1,g.value={name:"",description:""},C.value=!0}async function B(n){D.value=!0;const e=await o.fetchProductTypeById(n.id);e?g.value={id:e.id,name:e.name,description:e.description||""}:g.value={id:n.id,name:n.name,description:n.description||""},C.value=!0}async function Z(){if(!g.value.name){d.notify({type:"negative",message:"Название типа товара обязательно."});return}const n={name:g.value.name,description:g.value.description||""};let e=!1;D.value&&g.value.id?await o.updateProductType(g.value.id,n)&&(e=!0):await o.createProductType(n)&&(e=!0),e&&(C.value=!1)}function ee(){Y.create({title:"Подтвердите удаление",message:`Вы уверены, что хотите удалить ${v.value.length} элементов?`,persistent:!0,ok:{label:"Удалить",color:"negative"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{te()})}async function te(){S.value=!0;try{await o.bulkDeleteProductTypes(v.value.map(e=>e.id))&&(v.value=[])}finally{S.value=!1}}function I(n){Y.create({title:"Подтвердите удаление",message:`Вы уверены, что хотите удалить тип товара "${n.name}"?`,persistent:!0,ok:{label:"Удалить",color:"negative"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{o.deleteProductType(n.id).catch(e=>{d.notify({type:"negative",message:"Ошибка при удалении типа товара"}),console.error("Delete product type error:",e)})})}async function le(n,e){const a=n.target;if(a.closest(".q-btn")||a.closest("button"))return;const r=await o.fetchProductTypeById(e.id);r&&(u.value=r,k.value=!0)}async function ae(){u.value&&(k.value=!1,await B(u.value))}function se(){u.value&&(k.value=!1,I(u.value))}function N(n){return _e.formatDate(n,"DD.MM.YYYY HH:mm")}return ie(async()=>{await o.fetchProductTypes()}),(n,e)=>(f(),x(xe,{padding:""},{default:l(()=>[i("div",Te,[i("div",he,[e[8]||(e[8]=i("div",{class:"text-h5"},"Управление типами товаров",-1)),t(c,{color:"primary",icon:"add",onClick:X,label:s(d).screen.gt.xs?"Добавить тип":"",round:s(d).screen.xs},null,8,["label","round"])]),t(pe,null,{default:l(()=>[v.value.length>0?(f(),w("div",Ce,[t(Q,{flat:"",bordered:"",class:"bg-blue-1"},{default:l(()=>[t(T,{class:"q-pa-sm"},{default:l(()=>[i("div",{class:de(s(d).screen.xs?"column q-gutter-y-sm":"row items-center justify-between")},[i("span",qe,m(v.value.length)+" выбрано",1),i("div",Pe,[t(c,{dense:s(d).screen.xs,size:(s(d).screen.xs,"md"),flat:"",color:"negative",icon:"delete",onClick:ee,loading:S.value,label:"Удалить"},null,8,["dense","size","loading"])])],2)]),_:1})]),_:1})])):y("",!0)]),_:1})]),i("div",De,[t(U,{modelValue:z.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>z.value=a),K],placeholder:"Поиск по названию типа товара...",clearable:"",outlined:"",dense:"",onClear:W},{prepend:l(()=>[t(q,{name:"search"})]),_:1},8,["modelValue"])]),s(o).loading?(f(),w("div",Qe,[t(ue,{color:"primary",size:"3em"})])):y("",!0),!s(o).loading&&s(d).screen.gt.xs?(f(),w("div",Ve,[t(ve,{title:"Типы товаров",rows:s(o).productTypes,columns:H,"row-key":"id",loading:s(o).loading,pagination:s(o).qTablePagination,"onUpdate:pagination":e[1]||(e[1]=a=>s(o).qTablePagination=a),selected:v.value,"onUpdate:selected":e[2]||(e[2]=a=>v.value=a),selection:"multiple",onRequest:J,onRowClick:le,"binary-state-sort":"","rows-per-page-options":[5,10,20,30,50],class:"cursor-pointer product-types-table"},{"body-cell-description":l(a=>[t(A,{props:a},{default:l(()=>[i("div",ze,m(a.row.description||"-"),1)]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[t(A,{props:a,class:"text-right"},{default:l(()=>[i("div",Se,[t(c,{flat:"",round:"",dense:"",icon:"visibility",color:"primary",onClick:V(r=>F(a.row),["stop"])},{default:l(()=>[t($,null,{default:l(()=>e[9]||(e[9]=[p("Просмотр")])),_:1,__:[9]})]),_:2},1032,["onClick"]),t(c,{flat:"",round:"",dense:"",icon:"edit",onClick:V(r=>B(a.row),["stop"])},{default:l(()=>[t($,null,{default:l(()=>e[10]||(e[10]=[p("Редактировать")])),_:1,__:[10]})]),_:2},1032,["onClick"]),t(c,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:V(r=>I(a.row),["stop"])},{default:l(()=>[t($,null,{default:l(()=>e[11]||(e[11]=[p("Удалить")])),_:1,__:[11]})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":l(({icon:a,message:r,filter:oe})=>[i("div",Be,[t(q,{size:"2em",name:oe?"filter_b_and_w":a},null,8,["name"]),i("span",null,m(r),1)])]),_:1},8,["rows","loading","pagination","selected"])])):y("",!0),!s(o).loading&&s(d).screen.xs?(f(),w("div",Ie,[i("div",Ue,[i("div",$e,"Всего: "+m(s(o).totalCount),1),i("div",Fe,[t(c,{flat:"",dense:"",icon:"chevron_left",onClick:s(o).goToPreviousPage,disable:!s(o).hasPrevious},null,8,["onClick","disable"]),i("span",Ne,m(s(o).currentPage)+" / "+m(s(o).totalPages),1),t(c,{flat:"",dense:"",icon:"chevron_right",onClick:s(o).goToNextPage,disable:!s(o).hasNext},null,8,["onClick","disable"])])]),i("div",Re,[(f(!0),w(re,null,ce(s(o).productTypes,a=>(f(),x(ge,{key:a.id,class:"product-type-card","header-class":v.value.some(r=>r.id===a.id)?"bg-blue-1":""},{header:l(()=>[i("div",je,[t(me,{"model-value":v.value.some(r=>r.id===a.id),"onUpdate:modelValue":r=>G(a,r),class:"q-mr-sm",onClick:e[3]||(e[3]=V(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),t(R,{size:"40px",class:"q-mr-md bg-primary text-white"},{default:l(()=>[t(q,{name:"category"})]),_:1}),i("div",Ee,[i("div",Le,m(a.name),1),i("div",Me,m(a.description||"Без описания"),1)])])]),default:l(()=>[t(Q,{flat:""},{default:l(()=>[t(T,{class:"q-pt-none"},{default:l(()=>[a.description?(f(),w("div",Ye,[e[12]||(e[12]=i("strong",null,"Описание:",-1)),e[13]||(e[13]=i("br",null,null,-1)),p(" "+m(a.description),1)])):y("",!0),i("div",Ae,[t(c,{unelevated:"",color:"primary",icon:"visibility",label:"Просмотреть детали",onClick:r=>F(a),class:"full-width"},null,8,["onClick"]),i("div",Oe,[t(c,{outline:"",color:"warning",icon:"edit",label:"Изменить",onClick:r=>B(a),class:"col"},null,8,["onClick"]),t(c,{outline:"",color:"negative",icon:"delete",label:"Удалить",onClick:r=>I(a),class:"col"},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["header-class"]))),128))]),s(o).productTypes.length===0?(f(),w("div",He,[t(q,{name:"category",size:"4em",color:"grey-4"}),e[14]||(e[14]=i("div",{class:"text-grey-6 q-mt-sm"},"Типы товаров не найдены",-1))])):y("",!0)])):y("",!0),t(j,{modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=a=>C.value=a),persistent:"",maximized:s(d).screen.xs},{default:l(()=>[t(Q,{style:E(s(d).screen.xs?"":"min-width: 400px")},{default:l(()=>[t(T,null,{default:l(()=>[i("div",Ge,m(D.value?"Редактировать тип товара":"Добавить тип товара"),1)]),_:1}),t(T,{class:"q-pt-none"},{default:l(()=>[t(U,{modelValue:g.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value.name=a),label:"Название *",autofocus:"",rules:[a=>!!a||"Название обязательно"],"lazy-rules":""},null,8,["modelValue","rules"]),t(U,{modelValue:g.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value.description=a),label:"Описание",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),t(L,{align:"right"},{default:l(()=>[M(t(c,{flat:"",label:"Отмена"},null,512),[[O]]),t(c,{flat:"",label:"Сохранить",color:"primary",onClick:Z,loading:s(o).loading},null,8,["loading"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"]),t(j,{modelValue:k.value,"onUpdate:modelValue":e[7]||(e[7]=a=>k.value=a),maximized:s(d).screen.xs},{default:l(()=>[t(Q,{style:E(s(d).screen.xs?"":"min-width: 500px; max-width: 600px")},{default:l(()=>[t(T,{class:"row items-center q-pb-none"},{default:l(()=>[e[15]||(e[15]=i("div",{class:"text-h6"},"Детали типа товара",-1)),t(ye),M(t(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[O]])]),_:1,__:[15]}),u.value?(f(),x(T,{key:0},{default:l(()=>[t(be,null,{default:l(()=>[t(P,null,{default:l(()=>[t(h,{avatar:""},{default:l(()=>[t(R,{color:"primary","text-color":"white"},{default:l(()=>[t(q,{name:"category"})]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(_,{class:"text-weight-medium"},{default:l(()=>e[16]||(e[16]=[p("Название")])),_:1,__:[16]}),t(_,{caption:"",class:"text-body1"},{default:l(()=>[p(m(u.value.name),1)]),_:1})]),_:1})]),_:1}),u.value.description?(f(),x(P,{key:0},{default:l(()=>[t(h,null,{default:l(()=>[t(_,{class:"text-weight-medium"},{default:l(()=>e[17]||(e[17]=[p("Описание")])),_:1,__:[17]}),t(_,{caption:"",class:"text-body1"},{default:l(()=>[p(m(u.value.description),1)]),_:1})]),_:1})]),_:1})):y("",!0),u.value.creator?(f(),x(P,{key:1},{default:l(()=>[t(h,null,{default:l(()=>[t(_,{class:"text-weight-medium"},{default:l(()=>e[18]||(e[18]=[p("Создатель")])),_:1,__:[18]}),t(_,{caption:"",class:"text-body1"},{default:l(()=>[p(m(u.value.creator.email),1)]),_:1})]),_:1})]),_:1})):y("",!0),u.value.created?(f(),x(P,{key:2},{default:l(()=>[t(h,null,{default:l(()=>[t(_,{class:"text-weight-medium"},{default:l(()=>e[19]||(e[19]=[p("Дата создания")])),_:1,__:[19]}),t(_,{caption:"",class:"text-body1"},{default:l(()=>[p(m(N(u.value.created)),1)]),_:1})]),_:1})]),_:1})):y("",!0),u.value.updated?(f(),x(P,{key:3},{default:l(()=>[t(h,null,{default:l(()=>[t(_,{class:"text-weight-medium"},{default:l(()=>e[20]||(e[20]=[p("Дата обновления")])),_:1,__:[20]}),t(_,{caption:"",class:"text-body1"},{default:l(()=>[p(m(N(u.value.updated)),1)]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1})]),_:1})):y("",!0),t(L,{align:"right",class:"q-pa-md"},{default:l(()=>[t(c,{label:s(d).screen.xs?"":"Редактировать",color:"primary",onClick:ae,icon:"edit",round:s(d).screen.xs},null,8,["label","round"]),t(c,{label:s(d).screen.xs?"":"Удалить",color:"negative",onClick:se,icon:"delete",round:s(d).screen.xs},null,8,["label","round"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])]),_:1}))}}),at=ke(Je,[["__scopeId","data-v-9e27ae77"]]);export{at as default};
