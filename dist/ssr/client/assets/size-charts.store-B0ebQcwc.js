import{s as $,r as m,h as u,aA as n,aB as c}from"./index-CXeQdQLH.js";import{u as D}from"./usePagination-CH_YJQGk.js";const _="2d7dd621-7a0c-4be8-ac04-46ec289dd34d",q=$("sizeCharts",()=>{const d=m([]),l=m(null),i=u(()=>_),r=D(async(e,t)=>{if(!i.value)throw new Error("VITE_SITE_ID не определен.");try{let a,s={};e?a=e:(a=`/sites/${i.value}/size-charts/`,s=Object.entries(t||{}).reduce((v,[h,p])=>(p!==void 0&&(v[h]=p),v),{}));const{data:f}=await c.get(a,{params:e?{}:s});return d.value=f.results,f}catch(a){throw o(a,"Не удалось загрузить список размерных сеток."),a}},{defaultPageSize:10,defaultSortBy:"name",defaultDescending:!1});function o(e,t){console.error(t,e);let a=t;const s=e.response?.data;if(typeof s=="string"?a=s:s?.detail?a=s.detail:s?.message?a=s.message:e.message&&(a=e.message),s&&typeof s=="object"&&!s.detail&&!s.message){const f=Object.entries(s).map(([v,h])=>`${v}: ${Array.isArray(h)?h.join(", "):String(h)}`).join("; ");f&&(a=f)}n.create({type:"negative",message:a,timeout:5e3})}async function g(e){return r.fetchData(e)}async function y(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await c.get(`/sites/${i.value}/size-charts/${e}/`);return l.value=t,t}catch(t){return o(t,"Не удалось загрузить данные размерной сетки."),l.value=null,null}}async function S(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:t}=await c.post(`/sites/${i.value}/size-charts/`,e);return n.create({type:"positive",message:`Размерная сетка "${t.name}" успешно создана.`}),await g(),t}catch(t){return o(t,"Ошибка при создании размерной сетки."),null}}async function z(e,t){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),null;try{const{data:a}=await c.put(`/sites/${i.value}/size-charts/${e}/`,t);return n.create({type:"positive",message:`Размерная сетка "${a.name}" успешно обновлена.`}),await g(),l.value?.id===e&&await y(e),a}catch(a){return o(a,"Ошибка при обновлении размерной сетки."),null}}async function T(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await c.delete(`/sites/${i.value}/size-charts/${e}/`),n.create({type:"positive",message:"Размерная сетка успешно удалена."}),await g(),l.value?.id===e&&(l.value=null),!0}catch(t){return o(t,"Ошибка при удалении размерной сетки."),!1}}function P(){l.value=null}async function I(e){if(!i.value)return n.create({type:"negative",message:"VITE_SITE_ID не определен."}),!1;try{return await Promise.all(e.map(t=>c.delete(`/sites/${i.value}/size-charts/${t}/`))),n.create({type:"positive",message:`Успешно удалено ${e.length} размерных сеток.`}),await g(),!0}catch(t){return o(t,"Ошибка при массовом удалении размерных сеток."),!1}}async function E(e){return r.setSearch(e),await r.fetchData()}async function w(e){return Object.entries(e).forEach(([t,a])=>{r.setFilter(t,a)}),await r.fetchData()}async function C(){return r.clearFilters(),await r.fetchData()}return{sizeCharts:d,selectedSizeChart:l,loading:r.loading,currentPage:u(()=>r.currentPage.value),pageSize:u(()=>r.pageSize.value),totalCount:u(()=>r.totalCount.value),totalPages:u(()=>r.totalPages.value),hasNext:u(()=>r.hasNext.value),hasPrevious:u(()=>r.hasPrevious.value),qTablePagination:r.qTablePagination,fetchSizeCharts:g,fetchSizeChartById:y,createSizeChart:S,updateSizeChart:z,deleteSizeChart:T,clearSelectedSizeChart:P,searchSizeCharts:E,filterSizeCharts:w,clearFilters:C,bulkDeleteSizeCharts:I,goToPage:r.goToPage,goToNextPage:r.goToNextPage,goToPreviousPage:r.goToPreviousPage,handleTableRequest:r.handleTableRequest}});export{q as u};
