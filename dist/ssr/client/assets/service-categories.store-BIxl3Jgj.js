import{s as H,r as h,h as c,aB as g,aA as l}from"./index-CXeQdQLH.js";import{u as z}from"./usePagination-CH_YJQGk.js";const R="2d7dd621-7a0c-4be8-ac04-46ec289dd34d",W=H("serviceCategories",()=>{const y=h([]),f=h(null),d=h([]),C=h(!1),T=h([]),S=h({total_count:0,max_level:0}),w=h(!1),i=c(()=>R),_=async(e,t)=>{if(!i.value)throw new Error("VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½.");try{let r,a={};e?r=e:(r=`/sites/${i.value}/service-categories/`,a=Object.entries(t||{}).reduce((v,[o,p])=>(p!==void 0&&(v[o]=p),v),{}));const{data:n}=await g.get(r,{params:e?{}:a});return y.value=n.results,n}catch(r){throw u(r,"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ ÑƒÑÐ»ÑƒÐ³."),r}},s=z(_,{defaultPageSize:10,defaultSortBy:"order",defaultDescending:!1});function u(e,t){console.error(t,e);let r=t;const a=e.response?.data;if(typeof a=="string"?r=a:a?.detail?r=a.detail:a?.message?r=a.message:e.message&&(r=e.message),a&&typeof a=="object"&&!a.detail&&!a.message){const n=Object.entries(a).map(([v,o])=>`${v}: ${Array.isArray(o)?o.join(", "):String(o)}`).join("; ");n&&(r=n)}l.create({type:"negative",message:r,timeout:5e3})}function $(e){if(e.length===0)return e;const t=new Map;e.forEach(a=>{const n=a.parent?.id||null;t.has(n)||t.set(n,[]),t.get(n).push(a)});function r(a){const n=t.get(a)||[],v=[];return n.sort((o,p)=>o.order!==p.order?o.order-p.order:o.name.localeCompare(p.name)),n.forEach(o=>{v.push(o),v.push(...r(o.id))}),v}return r(null)}async function I(){if(C.value&&d.value.length>0)return d.value;console.log("ðŸ”„ Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð²ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð² ÐºÐµÑˆ...");const e=[];try{s.clearFilters();let t=await _();for(e.push(...t.results);t.next;)t=await _(t.next),e.push(...t.results);const r=Array.from(new Map(e.map(a=>[a.id,a])).values());return d.value=r,C.value=!0,D(r),console.log(`âœ… Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð² ÐºÐµÑˆ: ${r.length}`),r}catch(t){throw console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð²ÑÐµÑ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹:",t),t}}function D(e){if(!e||e.length===0){S.value={total_count:0,max_level:0};return}const t=e.reduce((r,a)=>Math.max(r,a.level),0);S.value={total_count:e.length,max_level:t},console.log(`ðŸ“Š ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð° Ð¼ÐµÑ‚Ð°-Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ: Ð²ÑÐµÐ³Ð¾=${e.length}, Ð¼Ð°ÐºÑ_ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ=${t}`)}function E(e=""){return(C.value?d.value:y.value).filter(a=>{if(!e)return!0;const n=e.toLowerCase();return a.name.toLowerCase().includes(n)||a.brief&&a.brief.toLowerCase().includes(n)}).map(a=>({id:a.id,name:a.name,slug:a.slug,brief:a.brief,level:a.level,has_children:a.has_children,is_published:a.is_published,display_name:"â€”".repeat(a.level)+" "+a.name+(a.has_children?" ðŸ“":"")+(a.is_published?"":" (ÑÐºÑ€Ñ‹Ñ‚Ð¾)")}))}function m(){console.log("ðŸ—‘ï¸ Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ ÐºÐµÑˆ..."),C.value=!1,d.value=[]}async function b(){if(!i.value)throw new Error("VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½.");w.value=!0;try{const{data:e}=await g.get(`/sites/${i.value}/service-categories/hierarchy/`);return T.value=e.categories,S.value=e.meta,e.categories}catch(e){throw u(e,"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¸ÐµÑ€Ð°Ñ€Ñ…Ð¸ÑŽ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ ÑƒÑÐ»ÑƒÐ³."),e}finally{w.value=!1}}async function P(e){if(!i.value)return l.create({type:"negative",message:"VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½."}),null;try{const{data:t}=await g.get(`/sites/${i.value}/service-categories/${e}/`);return f.value=t,t}catch(t){return u(t,"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ÑƒÑÐ»ÑƒÐ³."),f.value=null,null}}async function x(e){if(!i.value)return l.create({type:"negative",message:"VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½."}),null;try{const{data:t}=await g.post(`/sites/${i.value}/service-categories/`,e);return l.create({type:"positive",message:`ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑƒÑÐ»ÑƒÐ³ "${t.name}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ð½Ð°.`}),m(),t}catch(t){return u(t,"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ÑƒÑÐ»ÑƒÐ³."),null}}async function A(e,t){if(!i.value)return l.create({type:"negative",message:"VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½."}),null;try{const{data:r}=await g.put(`/sites/${i.value}/service-categories/${e}/`,t);return l.create({type:"positive",message:`ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑƒÑÐ»ÑƒÐ³ "${r.name}" ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð°.`}),m(),f.value?.id===e&&await P(e),r}catch(r){return u(r,"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ÑƒÑÐ»ÑƒÐ³."),null}}async function V(e){if(!i.value)return l.create({type:"negative",message:"VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½."}),!1;try{return await g.delete(`/sites/${i.value}/service-categories/${e}/`),l.create({type:"positive",message:"ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ ÑƒÑÐ»ÑƒÐ³ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°."}),m(),f.value?.id===e&&(f.value=null),!0}catch(t){return u(t,"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ ÑƒÑÐ»ÑƒÐ³."),!1}}async function q(e){if(!i.value)return l.create({type:"negative",message:"VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½."}),!1;try{return await Promise.all(e.map(t=>g.delete(`/sites/${i.value}/service-categories/${t}/`))),l.create({type:"positive",message:`Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾ ${e.length} ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ ÑƒÑÐ»ÑƒÐ³.`}),m(),!0}catch(t){return u(t,"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¼Ð°ÑÑÐ¾Ð²Ð¾Ð¼ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ ÑƒÑÐ»ÑƒÐ³."),!1}}async function F(e){if(!i.value)throw new Error("VITE_SITE_ID Ð½Ðµ Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½.");try{const{data:t}=await g.get(`/sites/${i.value}/service-categories/tree/`,{params:{search:e}});return t.results}catch(t){throw u(t,"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¸ÑÐº ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ ÑƒÑÐ»ÑƒÐ³."),t}}async function L(e){return s.setSearch(e),await s.fetchData()}async function j(e){return Object.entries(e).forEach(([t,r])=>{s.setFilter(t,r)}),await s.fetchData()}async function M(){return s.clearFilters(),await s.fetchData()}async function N(e){const t=await s.fetchData(e),r=$(t);return y.value=r,r}async function O(e){return await I(),E(e)}function B(){f.value=null}return{serviceCategories:y,selectedServiceCategory:f,hierarchyData:T,hierarchyMeta:S,hierarchyLoading:w,loading:s.loading,allCategoriesCache:c(()=>d.value),currentPage:c(()=>s.currentPage.value),pageSize:c(()=>s.pageSize.value),totalCount:c(()=>s.totalCount.value),totalPages:c(()=>s.totalPages.value),hasNext:c(()=>s.hasNext.value),hasPrevious:c(()=>s.hasPrevious.value),qTablePagination:s.qTablePagination,serviceCategoryOptions:c(()=>E()),fetchServiceCategories:N,fetchServiceCategoriesHierarchy:b,searchServiceCategoriesTree:F,fetchServiceCategoryById:P,createServiceCategory:x,updateServiceCategory:A,deleteServiceCategory:V,clearSelectedServiceCategory:B,searchServiceCategories:L,filterServiceCategories:j,clearFilters:M,bulkDeleteServiceCategories:q,searchCategoriesForAutocomplete:O,loadAllCategoriesIntoCache:I,invalidateCache:m,goToPage:s.goToPage,goToNextPage:s.goToNextPage,goToPreviousPage:s.goToPreviousPage,handleTableRequest:s.handleTableRequest}});export{W as u};
