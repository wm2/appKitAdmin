import{d as ce,r as x,a2 as me,v as w,o as y,x as a,a as i,c as h,y as b,e,f as c,z as n,ao as z,ap as C,aq as fe,B as _,ar as j,a5 as M,am as _e,as as q,A as f,a9 as ve,aa as ye,au as ge,at as E,av as L,aw as O,ax as be,ay as Y,D as A,az as T}from"./index-CXeQdQLH.js";import{u as pe,a as xe,b as we,c as H,Q as G,d as ke,C as J,e as Se,f as he}from"./date-CyQUtB3O.js";import{Q as U,a as Ce,d as D,e as k,f as g}from"./usePagination-CH_YJQGk.js";import{Q as qe}from"./QPage-7ngJVt63.js";import{u as De}from"./measurement-systems.store-CmvMNRvk.js";import{_ as Qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"q-mb-md"},Ve={class:"row justify-between items-center"},ze={key:0,class:"q-mt-sm"},Be={class:"text-blue-8 text-body2"},$e={class:"row q-gutter-xs"},Pe={class:"q-mb-md"},Te={key:0,class:"flex flex-center q-pa-md"},Ue={key:1,class:"desktop-view"},Ie={class:"row no-wrap q-gutter-xs justify-end"},Fe={class:"full-width row flex-center text-accent q-gutter-sm"},Ne={key:2,class:"mobile-view"},Re={class:"row items-center justify-between q-mb-md"},je={class:"text-caption text-grey-7"},Ee={class:"row q-gutter-xs"},Le={class:"text-caption q-px-sm"},Oe={class:"q-gutter-sm"},Ye={class:"row items-center full-width no-wrap"},Ae={class:"col-grow q-mr-md"},He={class:"text-weight-medium"},Ge={class:"text-caption text-grey-6"},Je={class:"column q-gutter-sm"},Ke={class:"row q-gutter-sm"},We={key:0,class:"text-center q-pa-lg"},Xe={class:"text-h6"},Ze=ce({__name:"MeasurementSystemPage",setup(et){const u=pe(),o=De(),Q=x(!1),S=x(!1),V=x(!1),r=x(null),B=x(""),m=x([]),p=x(!1),v=x({name:"",is_base_system:!1}),K=[{name:"name",required:!0,label:"Название",align:"left",field:"name",sortable:!0},{name:"is_base_system",label:"Тип системы",field:"is_base_system",align:"center",sortable:!0},{name:"actions",label:"Действия",field:"id",align:"right"}];function W(l,t){t?m.value.some(s=>s.id===l.id)||m.value.push(l):m.value=m.value.filter(s=>s.id!==l.id)}async function X(l){l.pagination&&await o.handleTableRequest(l)}async function Z(l){const t=l?String(l).trim():"";t.length>=2?await o.filterMeasurementSystems({name:t}):t.length===0&&await o.clearFilters()}async function ee(){B.value="",await o.clearFilters()}async function I(l){const t=await o.fetchMeasurementSystemById(l.id);t&&(r.value=t,S.value=!0)}function te(){V.value=!1,v.value={name:"",is_base_system:!1},Q.value=!0}async function $(l){V.value=!0;const t=await o.fetchMeasurementSystemById(l.id);t?v.value={id:t.id,name:t.name,is_base_system:t.is_base_system}:v.value={id:l.id,name:l.name,is_base_system:l.is_base_system},Q.value=!0}async function ae(){if(!v.value.name){u.notify({type:"negative",message:"Название системы измерений обязательно."});return}const l=typeof v.value.is_base_system=="boolean"?v.value.is_base_system:!1,t={name:v.value.name,is_base_system:l};let s=!1;V.value&&v.value.id?await o.updateMeasurementSystem(v.value.id,t)&&(s=!0):await o.createMeasurementSystem(t)&&(s=!0),s&&(Q.value=!1)}async function F(l){await o.patchMeasurementSystemStatus(l.id,!l.is_base_system)}function N(l){if(u.screen.xs){const t=!l.is_base_system,s=t?"сделать базовой":"убрать из базовых";T.create({title:"Подтвердите действие",message:`Вы уверены, что хотите ${s} систему "${l.name}"?`,persistent:!0,ok:{label:t?"Сделать базовой":"Убрать из базовых",color:t?"green":"orange"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{F(l)})}else F(l)}function se(){T.create({title:"Подтвердите удаление",message:`Вы уверены, что хотите удалить ${m.value.length} элементов?`,persistent:!0,ok:{label:"Удалить",color:"negative"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{le()})}async function le(){p.value=!0;try{await o.bulkDeleteMeasurementSystems(m.value.map(t=>t.id))&&(m.value=[])}finally{p.value=!1}}async function ne(){p.value=!0;try{await o.bulkUpdateMeasurementSystemStatus(m.value.map(t=>t.id),!0)&&(m.value=[])}finally{p.value=!1}}async function oe(){p.value=!0;try{await o.bulkUpdateMeasurementSystemStatus(m.value.map(t=>t.id),!1)&&(m.value=[])}finally{p.value=!1}}function P(l){T.create({title:"Подтвердите удаление",message:`Вы уверены, что хотите удалить систему "${l.name}"?`,persistent:!0,ok:{label:"Удалить",color:"negative"},cancel:{label:"Отмена",flat:!0}}).onOk(()=>{o.deleteMeasurementSystem(l.id).catch(t=>{u.notify({type:"negative",message:"Ошибка при удалении системы измерений"}),console.error("Delete measurement system error:",t)})})}async function ie(l,t){const s=l.target;if(s.closest(".q-btn")||s.closest("button"))return;const d=await o.fetchMeasurementSystemById(t.id);d&&(r.value=d,S.value=!0)}async function ue(){r.value&&(S.value=!1,await $(r.value))}function re(){r.value&&(S.value=!1,P(r.value))}function R(l){return he.formatDate(l,"DD.MM.YYYY HH:mm")}return me(async()=>{await o.fetchMeasurementSystems()}),(l,t)=>(y(),w(qe,{padding:""},{default:a(()=>[i("div",Me,[i("div",Ve,[t[8]||(t[8]=i("div",{class:"text-h5"},"Управление системами измерений",-1)),e(c,{color:"primary",icon:"add",onClick:te,label:n(u).screen.gt.xs?"Добавить систему":"",round:n(u).screen.xs},null,8,["label","round"])]),e(xe,null,{default:a(()=>[m.value.length>0?(y(),h("div",ze,[e(z,{flat:"",bordered:"",class:"bg-blue-1"},{default:a(()=>[e(C,{class:"q-pa-sm"},{default:a(()=>[i("div",{class:fe(n(u).screen.xs?"column q-gutter-y-sm":"row items-center justify-between")},[i("span",Be,_(m.value.length)+" выбрано",1),i("div",$e,[e(c,{dense:n(u).screen.xs,size:(n(u).screen.xs,"md"),flat:"",color:"green",icon:"star",onClick:ne,loading:p.value,label:"Сделать базовой"},null,8,["dense","size","loading"]),e(c,{dense:n(u).screen.xs,size:(n(u).screen.xs,"md"),flat:"",color:"orange",icon:"star_outline",onClick:oe,loading:p.value,label:"Убрать базовую"},null,8,["dense","size","loading"]),e(c,{dense:n(u).screen.xs,size:(n(u).screen.xs,"md"),flat:"",color:"negative",icon:"delete",onClick:se,loading:p.value,label:"Удалить"},null,8,["dense","size","loading"])])],2)]),_:1})]),_:1})])):b("",!0)]),_:1})]),i("div",Pe,[e(j,{modelValue:B.value,"onUpdate:modelValue":[t[0]||(t[0]=s=>B.value=s),Z],placeholder:"Поиск по названию системы измерений...",clearable:"",outlined:"",dense:"",onClear:ee},{prepend:a(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),n(o).loading?(y(),h("div",Te,[e(_e,{color:"primary",size:"3em"})])):b("",!0),!n(o).loading&&n(u).screen.gt.xs?(y(),h("div",Ue,[e(we,{title:"Системы измерений",rows:n(o).measurementSystems,columns:K,"row-key":"id",loading:n(o).loading,pagination:n(o).qTablePagination,"onUpdate:pagination":t[1]||(t[1]=s=>n(o).qTablePagination=s),selected:m.value,"onUpdate:selected":t[2]||(t[2]=s=>m.value=s),selection:"multiple",onRequest:X,onRowClick:ie,"binary-state-sort":"","rows-per-page-options":[5,10,20,30,50],class:"cursor-pointer measurement-systems-table"},{"body-cell-is_base_system":a(s=>[e(H,{props:s},{default:a(()=>[e(G,{color:s.row.is_base_system?"green":"grey",icon:s.row.is_base_system?"star":"star_outline","text-color":"white",dense:"",size:"md",clickable:"",onClick:q(d=>N(s.row),["stop"])},{default:a(()=>[f(_(s.row.is_base_system?"Эталонная система":"Базовая система"),1)]),_:2},1032,["color","icon","onClick"])]),_:2},1032,["props"])]),"body-cell-actions":a(s=>[e(H,{props:s,class:"text-right"},{default:a(()=>[i("div",Ie,[e(c,{flat:"",round:"",dense:"",icon:"visibility",color:"primary",onClick:q(d=>I(s.row),["stop"])},{default:a(()=>[e(U,null,{default:a(()=>t[9]||(t[9]=[f("Просмотр")])),_:1,__:[9]})]),_:2},1032,["onClick"]),e(c,{flat:"",round:"",dense:"",icon:"edit",onClick:q(d=>$(s.row),["stop"])},{default:a(()=>[e(U,null,{default:a(()=>t[10]||(t[10]=[f("Редактировать")])),_:1,__:[10]})]),_:2},1032,["onClick"]),e(c,{flat:"",round:"",dense:"",icon:"delete",color:"negative",onClick:q(d=>P(s.row),["stop"])},{default:a(()=>[e(U,null,{default:a(()=>t[11]||(t[11]=[f("Удалить")])),_:1,__:[11]})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":a(({icon:s,message:d,filter:de})=>[i("div",Fe,[e(M,{size:"2em",name:de?"filter_b_and_w":s},null,8,["name"]),i("span",null,_(d),1)])]),_:1},8,["rows","loading","pagination","selected"])])):b("",!0),!n(o).loading&&n(u).screen.xs?(y(),h("div",Ne,[i("div",Re,[i("div",je,"Всего: "+_(n(o).totalCount),1),i("div",Ee,[e(c,{flat:"",dense:"",icon:"chevron_left",onClick:n(o).goToPreviousPage,disable:!n(o).hasPrevious},null,8,["onClick","disable"]),i("span",Le,_(n(o).currentPage)+" / "+_(n(o).totalPages),1),e(c,{flat:"",dense:"",icon:"chevron_right",onClick:n(o).goToNextPage,disable:!n(o).hasNext},null,8,["onClick","disable"])])]),i("div",Oe,[(y(!0),h(ve,null,ye(n(o).measurementSystems,s=>(y(),w(ke,{key:s.id,class:"measurement-system-card","header-class":m.value.some(d=>d.id===s.id)?"bg-blue-1":""},{header:a(()=>[i("div",Ye,[e(ge,{"model-value":m.value.some(d=>d.id===s.id),"onUpdate:modelValue":d=>W(s,d),class:"q-mr-sm",onClick:t[3]||(t[3]=q(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),e(E,{size:"40px",class:"q-mr-md bg-primary text-white"},{default:a(()=>[e(M,{name:s.is_base_system?"star":"straighten"},null,8,["name"])]),_:2},1024),i("div",Ae,[i("div",He,_(s.name),1),i("div",Ge,_(s.is_base_system?"Базовая система":"Обычная система"),1)]),e(c,{color:s.is_base_system?"green":"grey","text-color":"white",dense:"",size:"sm",onClick:q(d=>N(s),["stop"]),class:"q-mr-md",icon:s.is_base_system?"star":"star_outline"},null,8,["color","onClick","icon"])])]),default:a(()=>[e(z,{flat:""},{default:a(()=>[e(C,{class:"q-pt-none"},{default:a(()=>[i("div",Je,[e(c,{unelevated:"",color:"primary",icon:"visibility",label:"Просмотреть детали",onClick:d=>I(s),class:"full-width"},null,8,["onClick"]),i("div",Ke,[e(c,{outline:"",color:"warning",icon:"edit",label:"Изменить",onClick:d=>$(s),class:"col"},null,8,["onClick"]),e(c,{outline:"",color:"negative",icon:"delete",label:"Удалить",onClick:d=>P(s),class:"col"},null,8,["onClick"])])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["header-class"]))),128))]),n(o).measurementSystems.length===0?(y(),h("div",We,[e(M,{name:"straighten",size:"4em",color:"grey-4"}),t[12]||(t[12]=i("div",{class:"text-grey-6 q-mt-sm"},"Системы измерений не найдены",-1))])):b("",!0)])):b("",!0),e(L,{modelValue:Q.value,"onUpdate:modelValue":t[6]||(t[6]=s=>Q.value=s),persistent:"",maximized:n(u).screen.xs},{default:a(()=>[e(z,{style:O(n(u).screen.xs?"":"min-width: 400px")},{default:a(()=>[e(C,null,{default:a(()=>[i("div",Xe,_(V.value?"Редактировать систему измерений":"Добавить систему измерений"),1)]),_:1}),e(C,{class:"q-pt-none"},{default:a(()=>[e(j,{modelValue:v.value.name,"onUpdate:modelValue":t[4]||(t[4]=s=>v.value.name=s),label:"Название *",autofocus:"",rules:[s=>!!s||"Название обязательно"],"lazy-rules":""},null,8,["modelValue","rules"]),e(be,{modelValue:v.value.is_base_system,"onUpdate:modelValue":t[5]||(t[5]=s=>v.value.is_base_system=s),label:"Базовая система","left-label":""},null,8,["modelValue"])]),_:1}),e(Y,{align:"right"},{default:a(()=>[A(e(c,{flat:"",label:"Отмена"},null,512),[[J]]),e(c,{flat:"",label:"Сохранить",color:"primary",onClick:ae,loading:n(o).loading},null,8,["loading"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"]),e(L,{modelValue:S.value,"onUpdate:modelValue":t[7]||(t[7]=s=>S.value=s),maximized:n(u).screen.xs},{default:a(()=>[e(z,{style:O(n(u).screen.xs?"":"min-width: 500px; max-width: 600px")},{default:a(()=>[e(C,{class:"row items-center q-pb-none"},{default:a(()=>[t[13]||(t[13]=i("div",{class:"text-h6"},"Детали системы измерений",-1)),e(Se),A(e(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[J]])]),_:1,__:[13]}),r.value?(y(),w(C,{key:0},{default:a(()=>[e(Ce,null,{default:a(()=>[e(D,null,{default:a(()=>[e(k,{avatar:""},{default:a(()=>[e(E,{color:r.value.is_base_system?"green":"primary","text-color":"white"},{default:a(()=>[e(M,{name:r.value.is_base_system?"star":"straighten"},null,8,["name"])]),_:1},8,["color"])]),_:1}),e(k,null,{default:a(()=>[e(g,{class:"text-weight-medium"},{default:a(()=>t[14]||(t[14]=[f("Название")])),_:1,__:[14]}),e(g,{caption:"",class:"text-body1"},{default:a(()=>[f(_(r.value.name),1)]),_:1})]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(k,null,{default:a(()=>[e(g,{class:"text-weight-medium"},{default:a(()=>t[15]||(t[15]=[f("Тип системы")])),_:1,__:[15]}),e(g,{caption:""},{default:a(()=>[e(G,{color:r.value.is_base_system?"green":"grey","text-color":"white",size:"sm"},{default:a(()=>[f(_(r.value.is_base_system?"Базовая система":"Обычная система"),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1}),r.value.site?(y(),w(D,{key:0},{default:a(()=>[e(k,null,{default:a(()=>[e(g,{class:"text-weight-medium"},{default:a(()=>t[16]||(t[16]=[f("Сайт")])),_:1,__:[16]}),e(g,{caption:"",class:"text-body1"},{default:a(()=>[f(_(r.value.site),1)]),_:1})]),_:1})]),_:1})):b("",!0),r.value.creator?(y(),w(D,{key:1},{default:a(()=>[e(k,null,{default:a(()=>[e(g,{class:"text-weight-medium"},{default:a(()=>t[17]||(t[17]=[f("Создатель")])),_:1,__:[17]}),e(g,{caption:"",class:"text-body1"},{default:a(()=>[f(_(r.value.creator.email),1)]),_:1})]),_:1})]),_:1})):b("",!0),r.value.created?(y(),w(D,{key:2},{default:a(()=>[e(k,null,{default:a(()=>[e(g,{class:"text-weight-medium"},{default:a(()=>t[18]||(t[18]=[f("Дата создания")])),_:1,__:[18]}),e(g,{caption:"",class:"text-body1"},{default:a(()=>[f(_(R(r.value.created)),1)]),_:1})]),_:1})]),_:1})):b("",!0),r.value.updated?(y(),w(D,{key:3},{default:a(()=>[e(k,null,{default:a(()=>[e(g,{class:"text-weight-medium"},{default:a(()=>t[19]||(t[19]=[f("Дата обновления")])),_:1,__:[19]}),e(g,{caption:"",class:"text-body1"},{default:a(()=>[f(_(R(r.value.updated)),1)]),_:1})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1})):b("",!0),e(Y,{align:"right",class:"q-pa-md"},{default:a(()=>[e(c,{label:n(u).screen.xs?"":"Редактировать",color:"primary",onClick:ue,icon:"edit",round:n(u).screen.xs},null,8,["label","round"]),e(c,{label:n(u).screen.xs?"":"Удалить",color:"negative",onClick:re,icon:"delete",round:n(u).screen.xs},null,8,["label","round"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])]),_:1}))}}),it=Qe(Ze,[["__scopeId","data-v-0ff47c49"]]);export{it as default};
